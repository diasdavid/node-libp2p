# Migrating to libp2p@45 <!-- omit in toc -->

A migration guide for refactoring your application code from libp2p v0.44.x to v0.45.0.

## Table of Contents <!-- omit in toc -->

- [Events](#events)
  - [Emitters](#emitters)
  - [Event changes](#event-changes)
    - [`peer:connect`](#peerconnect)
    - [`peer:disconnect`](#peerdisconnect)
    - [`peer:update`](#peerupdate)
    - [`self:peer:update`](#selfpeerupdate)

## Events

The events emitted by libp2p have been refactored to be more consistent and to give more insight into the inner workings of libp2p.

> Please see the [API docs](https://libp2p.github.io/js-libp2p-interfaces/interfaces/_libp2p_interface_libp2p.Libp2pEvents.html) for an exhaustive list of events emitted by Libp2p.

### Emitters

The primary interaction point for events is now the libp2p node itself, no need to access internal properties to set up listeners.

**Before**

```js
import { createLibp2p } from 'libp2p'

const node = await createLibp2p({ /* ... */ })
node.connectionManager.addEventListener('peer:connect', () => {})
```

**After**

```js
import { createLibp2p } from 'libp2p'

const node = await createLibp2p({ /* ... */ })
node.addEventListener('peer:connect', () => {})
```

### Event changes

Some types have changed.

> Please see the [API docs](https://libp2p.github.io/js-libp2p-interfaces/interfaces/_libp2p_interface_libp2p.Libp2pEvents.html) for an exhaustive list of events emitted by Libp2p.

#### `peer:connect`

The detail field for this event was a [Connection] now it is a [PeerId]

It is emitted when a new peer opens it's first connection.

To receive notifications of the opening of individual connections, listen for the `connection:open` event instead.

#### `peer:disconnect`

The detail field for this event was a [Connection] now it is a [PeerId]

It is emitted when all connections for the peer have been closed.

To receive notifications of the closing of individual connections, listen for the `connection:close` event instead.

#### `peer:update`

This event is emitted when a peer's data has been changed in the peer store.  This can be in response to a user manually updating the peer, or after the [Identify] protocol has completed.

#### `self:peer:update`

This event occurs when the data of the running node has changed.  It may have started listening on a new multiaddr, [AutoNAT] may have given us new confidence in an external address or a user may have manually updated the information.

[Connection]: https://libp2p.github.io/js-libp2p-interfaces/interfaces/_libp2p_interface_connection.Connection.html
[PeerId]: https://libp2p.github.io/js-libp2p-interfaces/types/_libp2p_interface_peer_id.PeerId.html
[Identify]: https://github.com/libp2p/specs/blob/master/identify/README.md
[AutoNAT]: https://github.com/libp2p/specs/blob/master/autonat/README.md