<!--Specify versions for migration below-->
# Migrating to libp2p@1.0 <!-- omit in toc -->

A migration guide for refactoring your application code from libp2p `v0.46` to `v1.0.0`.

## Table of Contents <!-- omit in toc -->

- [AutoNAT](#autonat)
- [KeyChain](#keychain)
- [Pnet](#pnet)
- [Metrics](#metrics)
- [Connection Manager](#connection-manager)

## AutoNAT

The AutoNAT service is now published in its own package.

**Before**

```ts
import { autoNATService } from 'libp2p/autonat'
```

**After**

```ts
import { autoNATService } from '@libp2p/autonat'
```

## KeyChain

The KeyChain object is no longer included on Libp2p and must be instantiated explicitly if desired.

**Before**

```ts
import type { KeyChain } from '@libp2p/interface/keychain'

const libp2p = await createLibp2p(...)

const keychain: KeyChain = libp2p.keychain
```

**After**

```ts
import { keychain, type Keychain } from '@libp2p/keychain'

const libp2p = await createLibp2p({
  ...
  services: {
    keychain: keychain()
  }
})

const keychain: Keychain = libp2p.services.keychain
```

## Pnet

The pnet module is now published in its own package.

**Before**

```ts
import { preSharedKey, generateKey } from 'libp2p/pnet'
```

**After**

```ts
import { preSharedKey, generateKey } from '@libp2p/pnet'
```

## Metrics

The following metrics were renamed:

`libp2p_dialler_pending_dials` => `libp2p_dial_queue_pending_dials`
`libp2p_dialler_in_progress_dials` => `libp2p_dial_queue_in_progress_dials`

## Connection Manager

The observed behavior of dialing peers has been that given a list of supported addresses, if any one routable address would succeed then all would succeed and that if any routable address would fail then all would fail.

Consequently the previous dial behaviour of dialing all available addresses (up to a concurrency limit) and cancelling any in-flight dials when the first succeeds was a very inefficient use of resources.

Since `libp2p@0.46.10` we have only dialed one address at a time for each peer by setting the default value of the `ConnectionManager`'s `maxParallelDialsPerPeer` option to `1`.  As of `libp2p@1.0.0` this option has been removed.
